<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8"/>
  <title>Манжерок — контроль выпуска РД (онлайн)</title>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <link rel="stylesheet" href="styles.css"/>
</head>
<body>
<header class="topbar">
  <h1>Манжерок — контроль выпуска РД (онлайн)</h1>
  <div class="top-actions">
    <button id="btnAddRow">+ Строка</button>
    <button id="btnExportCSV">Экспорт CSV</button>
    <button id="btnPrint">Печать / PDF</button>
  </div>
</header>

<main>
  <section class="dashboard">
    <div class="kpi"><div class="kpi-title">Всего</div><div class="kpi-value" id="kAll">—</div></div>
    <div class="kpi"><div class="kpi-title green">✅ Готово</div><div class="kpi-value" id="kDone">—</div></div>
    <div class="kpi"><div class="kpi-title yellow">⚙️ В работе</div><div class="kpi-value" id="kInProgress">—</div></div>
    <div class="kpi"><div class="kpi-title grey">⏳ Не начато</div><div class="kpi-value" id="kTodo">—</div></div>
    <div class="kpi"><div class="kpi-title">Новые листы</div><div class="kpi-value" id="kNew">—</div></div>
    <div class="kpi kpi-wide"><div class="kpi-title">Прогресс</div><div class="progress-wrap"><progress id="progressBar" value="0" max="100"></progress><span id="progressPct">0%</span></div></div>
  </section>
  <section class="controls">
    <div class="filter"><label>Статус:</label><select id="filterStatus"><option value="">Все</option><option>✅ Готово</option><option>⚙️ В работе</option><option>⏳ Не начато</option></select></div>
    <div class="filter"><label>Исполнитель:</label><select id="filterExecutor"><option value="">Все</option></select></div>
    <div class="filter"><label><input type="checkbox" id="filterNew"/> Только новые</label></div>
    <div class="filter"><span id="userInfo" class="badge">Подключение…</span></div>
  </section>
  <section class="table-wrap print-area">
    <table id="rdTable">
      <thead><tr><th>№</th><th>Наименование листа</th><th>Изменения / Примечания</th><th>Новый лист</th><th>Статус</th><th>Исполнитель</th><th>Дата сдачи</th><th>Комментарии</th><th>Ссылка на файл</th><th>Открыть</th></tr></thead>
      <tbody></tbody>
    </table>
  </section>
</main>
<footer class="foot no-print"><div>Данные синхронизируются через Firebase. Для PDF — кнопка «Печать / PDF».</div></footer>

<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.13.0/firebase-app.js";
  import { getAuth, signInAnonymously, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.13.0/firebase-auth.js";
  import { getAnalytics } from "https://www.gstatic.com/firebasejs/10.13.0/firebase-analytics.js";
  import { getFirestore } from "https://www.gstatic.com/firebasejs/10.13.0/firebase-firestore.js";

  const firebaseConfig = {
    apiKey: "AIzaSyCVCy0pdqRTrxsPzs_7bcelelCjMpcGli8",
    authDomain: "rd-tracker-f1921.firebaseapp.com",
    projectId: "rd-tracker-f1921",
    storageBucket: "rd-tracker-f1921.firebasestorage.app",
    messagingSenderId: "633046340169",
    appId: "1:633046340169:web:e2d3d54f43af132d5c6598",
    measurementId: "G-6ZT47WT1EM"
  };

  const app = initializeApp(firebaseConfig);
  const analytics = getAnalytics(app);
  window._auth = getAuth(app);
  window._db = getFirestore(app);
  signInAnonymously(window._auth).catch(console.error);
  onAuthStateChanged(window._auth, (user) => {
    const el = document.getElementById('userInfo');
    if (user) {
      if (el) el.textContent = "UID: " + user.uid.slice(0,6) + "…";
      window._readyFirebase?.();
    }
  });
</script>
<script src="app.js"></script>
</body>
</html>