<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8"/>
  <title>Манжерок — контроль выпуска РД (онлайн)</title>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <link rel="icon" href="favicon.ico">
  <link rel="stylesheet" href="styles.css"/>
</head>
<body>
<header class="topbar">
  <h1>Манжерок — контроль выпуска РД (онлайн)</h1>
  <div class="top-actions">
    <button id="btnAddRow">+ Строка</button>
    <button id="btnSaveAll" class="secondary">Сохранить всё</button>
    <button id="btnExportCSV" class="secondary">Экспорт CSV</button>
    <button id="btnPrint">Печать / PDF</button>
  </div>
</header>

<main>
  <section class="kpi-bar">
    <div class="kpi"><div>Всего</div><div class="num" id="kAll">—</div></div>
    <div class="kpi"><div>✅ Готово</div><div class="num" id="kDone">—</div></div>
    <div class="kpi"><div>⚙️ В работе</div><div class="num" id="kInProgress">—</div></div>
    <div class="kpi"><div>⏳ Не начато</div><div class="num" id="kTodo">—</div></div>
    <div class="kpi"><div>Новые листы</div><div class="num" id="kNew">—</div></div>
    <div class="kpi">
      <div>Прогресс</div>
      <div class="progress-wrap"><progress id="progressBar" value="0" max="100"></progress><span id="progressPct">0%</span></div>
    </div>
  </section>

  <section class="controls">
    <label>Статус:
      <select id="filterStatus">
        <option value="">Все</option>
        <option>✅ Готово</option>
        <option>⚙️ В работе</option>
        <option>⏳ Не начато</option>
      </select>
    </label>
    <label>Исполнитель:
      <select id="filterExecutor">
        <option value="">Все</option>
      </select>
    </label>
    <label><input type="checkbox" id="filterNew"/> Только новые</label>
    <span id="userInfo" class="badge">Подключение…</span>
  </section>

  <section class="table-wrap print-area">
    <table id="rdTable">
      <thead>
        <tr>
          <th style="width:60px;">№</th>
          <th style="min-width:360px;">Наименование листа</th>
          <th style="min-width:320px;">Изменения / Примечания</th>
          <th style="width:100px;">Новый лист</th>
          <th style="width:160px;">Статус</th>
          <th style="width:200px;">Исполнитель</th>
          <th style="width:140px;">Дата сдачи</th>
          <th style="min-width:260px;">Комментарии</th>
          <th style="min-width:220px;">Ссылка на файл</th>
          <th style="width:100px;">Открыть</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>
  </section>
</main>

<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.13.0/firebase-app.js";
  import { getAuth, signInAnonymously, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.13.0/firebase-auth.js";
  import { getFirestore } from "https://www.gstatic.com/firebasejs/10.13.0/firebase-firestore.js";
  import { getAnalytics } from "https://www.gstatic.com/firebasejs/10.13.0/firebase-analytics.js";

  const firebaseConfig = {
    apiKey: "AIzaSyCVCy0pdqRTrxsPzs_7bcelelCjMpcGli8",
    authDomain: "rd-tracker-f1921.firebaseapp.com",
    projectId: "rd-tracker-f1921",
    storageBucket: "rd-tracker-f1921.firebasestorage.app",
    messagingSenderId: "633046340169",
    appId: "1:633046340169:web:e2d3d54f43af132d5c6598",
    measurementId: "G-6ZT47WT1EM"
  };

  const app = initializeApp(firebaseConfig);
  getAnalytics(app);
  window._auth = getAuth(app);
  window._db   = getFirestore(app);

  signInAnonymously(window._auth).catch(console.error);
  onAuthStateChanged(window._auth, user => {
    const el = document.getElementById('userInfo');
    if (user) { el.textContent = "UID: " + user.uid.slice(0,6) + "…"; window._readyFirebase?.(); }
    else { el.textContent = "Не авторизован"; }
  });
</script>
<script src="app.js"></script>
</body>
</html>
