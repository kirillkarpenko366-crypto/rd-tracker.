<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8"/>
  <title>Трекер РД — онлайн (Firebase)</title>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <link rel="stylesheet" href="styles.css"/>
</head>
<body>
<header class="topbar">
  <h1>Манжерок — контроль выпуска РД (онлайн)</h1>
  <div class="top-actions">
    <button id="btnAddRow">+ Строка</button>
    <button id="btnExportCSV">Экспорт CSV</button>
    <button id="btnPrint">Печать / PDF</button>
  </div>
</header>

<main>
  <section class="dashboard">
    <div class="kpi">
      <div class="kpi-title">Всего</div>
      <div class="kpi-value" id="kAll">—</div>
    </div>
    <div class="kpi">
      <div class="kpi-title green">✅ Готово</div>
      <div class="kpi-value" id="kDone">—</div>
    </div>
    <div class="kpi">
      <div class="kpi-title yellow">⚙️ В работе</div>
      <div class="kpi-value" id="kInProgress">—</div>
    </div>
    <div class="kpi">
      <div class="kpi-title grey">⏳ Не начато</div>
      <div class="kpi-value" id="kTodo">—</div>
    </div>
    <div class="kpi">
      <div class="kpi-title">Новые листы</div>
      <div class="kpi-value" id="kNew">—</div>
    </div>
    <div class="kpi kpi-wide">
      <div class="kpi-title">Прогресс</div>
      <div class="progress-wrap">
        <progress id="progressBar" value="0" max="100"></progress>
        <span id="progressPct">0%</span>
      </div>
    </div>
    <div class="chart">
      <svg id="pie" viewBox="0 0 42 42" class="donut">
        <circle class="donut-ring" cx="21" cy="21" r="15.91549430918954"></circle>
        <circle id="pieDone" class="donut-segment green" cx="21" cy="21" r="15.91549430918954" stroke-dasharray="0 100" stroke-dashoffset="25"></circle>
        <circle id="pieInProgress" class="donut-segment yellow" cx="21" cy="21" r="15.91549430918954" stroke-dasharray="0 100" stroke-dashoffset="25"></circle>
        <circle id="pieTodo" class="donut-segment grey" cx="21" cy="21" r="15.91549430918954" stroke-dasharray="0 100" stroke-dashoffset="25"></circle>
        <text x="50%" y="50%" text-anchor="middle" dominant-baseline="central" class="donut-text" id="pieCenter">0%</text>
      </svg>
      <div class="chart-legend">
        <div><span class="dot green"></span>Готово</div>
        <div><span class="dot yellow"></span>В работе</div>
        <div><span class="dot grey"></span>Не начато</div>
      </div>
    </div>
  </section>

  <section class="controls">
    <div class="filter">
      <label>Статус:</label>
      <select id="filterStatus">
        <option value="">Все</option>
        <option>✅ Готово</option>
        <option>⚙️ В работе</option>
        <option>⏳ Не начато</option>
      </select>
    </div>
    <div class="filter">
      <label>Исполнитель:</label>
      <select id="filterExecutor">
        <option value="">Все</option>
      </select>
    </div>
    <div class="filter">
      <label><input type="checkbox" id="filterNew"/> Только новые</label>
    </div>
    <div class="filter">
      <span id="userInfo" class="badge">…</span>
    </div>
  </section>

  <section class="table-wrap print-area">
    <table id="rdTable">
      <thead>
        <tr>
          <th style="width:56px;">№</th>
          <th>Наименование листа</th>
          <th>Изменения / Примечания</th>
          <th style="width:108px;">Новый лист</th>
          <th style="width:160px;">Статус</th>
          <th style="width:180px;">Исполнитель</th>
          <th style="width:140px;">Дата сдачи</th>
          <th>Комментарии</th>
          <th>Ссылка на файл</th>
          <th style="width:100px;">Открыть</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>
  </section>
</main>

<footer class="foot no-print">
  <div>Данные синхронизируются через Firebase. Для PDF-отчёта — кнопка «Печать / PDF».</div>
</footer>

<!-- Firebase SDK и инициализация -->
<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.13.0/firebase-app.js";
  import { getAuth, signInAnonymously, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.13.0/firebase-auth.js";
  import { getAnalytics } from "https://www.gstatic.com/firebasejs/10.13.0/firebase-analytics.js";
  import { getFirestore } from "https://www.gstatic.com/firebasejs/10.13.0/firebase-firestore.js";

  const firebaseConfig = {
    apiKey: "AIzaSyCVCy0pdqRTrxsPzs_7bcelelCjMpcGli8",
    authDomain: "rd-tracker-f1921.firebaseapp.com",
    projectId: "rd-tracker-f1921",
    storageBucket: "rd-tracker-f1921.firebasestorage.app",
    messagingSenderId: "633046340169",
    appId: "1:633046340169:web:e2d3d54f43af132d5c6598",
    measurementId: "G-6ZT47WT1EM"
  };

  const app = initializeApp(firebaseConfig);
  const analytics = getAnalytics(app);
  window._auth = getAuth(app);
  window._db = getFirestore(app);

  signInAnonymously(window._auth).catch(console.error);
  onAuthStateChanged(window._auth, (user) => {
    if (user) {
      const el = document.getElementById('userInfo');
      if (el) el.textContent = "UID: " + user.uid.substring(0, 6) + "… (аноним)";
      window._readyFirebase?.();
    }
  });
</script>

<script src="app.js"></script>
</body>
</html>
