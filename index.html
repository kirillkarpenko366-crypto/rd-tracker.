<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8"/>
  <title>Трекер РД — Манжерок</title>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <link rel="stylesheet" href="styles.css"/>
</head>
<body>
<header class="topbar">
  <h1>Манжерок — контроль выпуска РД</h1>
  <div class="top-actions">
    <button id="btnAddRow">+ Строка</button>
    <button id="btnExportJSON">Экспорт JSON</button>
    <button id="btnImportJSON">Импорт JSON</button>
    <button id="btnExportCSV">Экспорт CSV</button>
    <button id="btnPrint">Печать / PDF</button>
  </div>
</header>

<main>
  <section class="dashboard">
    <div class="kpi">
      <div class="kpi-title">Всего</div>
      <div class="kpi-value" id="kAll">0</div>
    </div>
    <div class="kpi">
      <div class="kpi-title green">✅ Готово</div>
      <div class="kpi-value" id="kDone">0</div>
    </div>
    <div class="kpi">
      <div class="kpi-title yellow">⚙️ В работе</div>
      <div class="kpi-value" id="kInProgress">0</div>
    </div>
    <div class="kpi">
      <div class="kpi-title grey">⏳ Не начато</div>
      <div class="kpi-value" id="kTodo">0</div>
    </div>
    <div class="kpi">
      <div class="kpi-title">Новые листы</div>
      <div class="kpi-value" id="kNew">0</div>
    </div>
    <div class="kpi kpi-wide">
      <div class="kpi-title">Прогресс</div>
      <div class="progress-wrap">
        <progress id="progressBar" value="0" max="100"></progress>
        <span id="progressPct">0%</span>
      </div>
    </div>
    <div class="chart">
      <svg id="pie" viewBox="0 0 42 42" class="donut">
        <circle class="donut-ring" cx="21" cy="21" r="15.91549430918954"></circle>
        <circle id="pieDone" class="donut-segment green" cx="21" cy="21" r="15.91549430918954" stroke-dasharray="0 100" stroke-dashoffset="25"></circle>
        <circle id="pieInProgress" class="donut-segment yellow" cx="21" cy="21" r="15.91549430918954" stroke-dasharray="0 100" stroke-dashoffset="25"></circle>
        <circle id="pieTodo" class="donut-segment grey" cx="21" cy="21" r="15.91549430918954" stroke-dasharray="0 100" stroke-dashoffset="25"></circle>
        <text x="50%" y="50%" text-anchor="middle" dominant-baseline="central" class="donut-text" id="pieCenter">0%</text>
      </svg>
      <div class="chart-legend">
        <div><span class="dot green"></span>Готово</div>
        <div><span class="dot yellow"></span>В работе</div>
        <div><span class="dot grey"></span>Не начато</div>
      </div>
    </div>
  </section>

  <section class="controls">
    <div class="filter">
      <label>Статус:</label>
      <select id="filterStatus">
        <option value="">Все</option>
        <option>✅ Готово</option>
        <option>⚙️ В работе</option>
        <option>⏳ Не начато</option>
      </select>
    </div>
    <div class="filter">
      <label>Исполнитель:</label>
      <select id="filterExecutor">
        <option value="">Все</option>
      </select>
    </div>
    <div class="filter">
      <label><input type="checkbox" id="filterNew"/> Только новые</label>
    </div>
  </section>

  <section class="table-wrap print-area">
    <table id="rdTable">
      <thead>
        <tr>
          <th style="width:56px;">№</th>
          <th>Наименование листа</th>
          <th>Изменения / Примечания</th>
          <th style="width:108px;">Новый лист</th>
          <th style="width:160px;">Статус</th>
          <th style="width:160px;">Исполнитель</th>
          <th style="width:140px;">Дата сдачи</th>
          <th>Комментарии</th>
          <th>Ссылка на файл</th>
          <th style="width:100px;">Открыть</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>
  </section>

  <aside class="history">
    <div class="history-head">
      <h2>История изменений</h2>
      <button id="btnClearHistory">Очистить</button>
    </div>
    <div class="history-log" id="historyLog"></div>
  </aside>
</main>

<footer class="foot no-print">
  <div>Данные сохраняются в браузере (LocalStorage). Для отчёта используйте кнопку «Печать / PDF».</div>
</footer>

<script>
  const EXECUTORS = [];
  const INITIAL_ROWS = [[1, "ОД", "Описывается 2-й ряд анкерных креплений, новую этапность, новая отметка дна котлована, остальное без изменений", false, "⏳ Не начато", "", "2025-10-24", "", "", ""], [2, "Схема выноса котлована (подготовительный этап)", "Без изменений", false, "✅ Готово", "", "2025-10-24", "", "", ""], [3, "Схема устройства форшахты", "Без изменений", false, "✅ Готово", "", "2025-10-24", "", "", ""], [4, "Схема выноса котлована (этап 2.1)", "Меняется откосная часть (контур, отметка дна 377.83)", false, "⏳ Не начато", "", "2025-10-24", "", "", ""], [5, "Схема котлована (этап 2.1)", "Меняется откосная часть (контур, отметка дна 377.83)", false, "⏳ Не начато", "", "2025-10-24", "", "", ""], [6, "Схема расположения сечений 1-1..7-7 (этап 2.1)", "Меняется дно и откосная часть на сечениях", false, "⏳ Не начато", "", "2025-10-24", "", "", ""], [7, "Схема расположения грунтовых анкеров (этап 2.1)", "Меняется дно и откосная часть (контур)", false, "⏳ Не начато", "", "2025-10-24", "", "", ""], [8, "Схема выноса котлована (этап 2.2)", "Меняется откосная часть (контур, отметка дна 373.83)", false, "⏳ Не начато", "", "2025-10-24", "", "", ""], [9, "Схема котлована (этап 2.2)", "Меняется откосная часть (контур, отметка дна 373.83)", false, "⏳ Не начато", "", "2025-10-24", "", "", ""], [10, "Схема расположения сечений 1-1..7-7 (этап 2.2)", "Меняется дно и откосная часть", false, "⏳ Не начато", "", "2025-10-24", "", "", ""], [11, "Схема расположения грунтовых анкеров (этап 2.2)", "Меняется дно, откос, количество и марка анкеров", false, "⏳ Не начато", "", "2025-10-24", "", "", ""], [12, "План котлована (этап 3)", "Новый лист, добавлены башенные краны", false, "⏳ Не начато", "", "2025-10-24", "", "", ""], [13, "Грунтовый анкер Г-1", "Без изменений", false, "✅ Готово", "", "2025-10-24", "", "", ""], [14, "Грунтовый анкер Г-2", "Новый лист", false, "⏳ Не начато", "", "2025-10-24", "", "", ""], [15, "Посадка ограждения котлована на ИГИ", "Добавляется ряд анкеров", false, "⏳ Не начато", "", "2025-10-24", "", "", ""], [16, "Узлы", "Добавлены узлы по анкеру Г-2, новый узел 1, обновлена ведомость деталей", false, "✅ Готово", "", "2025-10-24", "", "", ""], [17, "Схема армирования БСС", "Без изменений", false, "✅ Готово", "", "2025-10-24", "", "", ""], [18, "Схема армирования БНС", "Без изменений", false, "✅ Готово", "", "2025-10-24", "", "", ""], [19, "Закладная деталь Мн-1", "Без изменений", false, "✅ Готово", "", "2025-10-24", "", "", ""], [20, "Забирка", "Без изменений", false, "✅ Готово", "", "2025-10-24", "", "", ""], [21, "Спецификация", "Меняется — увеличение объемов", false, "⏳ Не начато", "", "2025-10-24", "", "", ""]];
</script>
<script src="app.js"></script>
</body>
</html>
